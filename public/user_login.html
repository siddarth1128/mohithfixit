<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Login - FixItNow</title>
        <link
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />
        <link rel="stylesheet" href="css/theme.css" />

        <script>
            // Prevent FOUC
            (function () {
                const theme = localStorage.getItem("theme") || "light";
                if (theme === "dark") {
                    document.documentElement.setAttribute("data-theme", "dark");
                }
            })();
        </script>

        <style>
            body {
                margin: 0;
                padding: 0;
                min-height: 100vh;
                display: flex;
                background: var(--background);
                overflow: hidden;
            }

            .theme-toggle {
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 1000;
                background: var(--card);
                border: 2px solid var(--border);
                border-radius: 50px;
                padding: 10px 16px;
                cursor: pointer;
                display: flex;
                align-items: center;
                gap: 10px;
                box-shadow: var(--shadow-lg);
                transition: all 0.3s ease;
            }

            .theme-toggle:hover {
                transform: translateY(-2px);
                border-color: var(--primary);
            }

            .theme-icon {
                font-size: 18px;
                color: var(--foreground);
            }

            .login-wrapper {
                display: flex;
                width: 100%;
                height: 100vh;
            }

            /* Left Side - Branding */
            .login-brand {
                flex: 1;
                background: var(--gradient-primary);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 60px;
                position: relative;
                overflow: hidden;
            }

            .login-brand::before {
                content: "";
                position: absolute;
                width: 500px;
                height: 500px;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 50%;
                top: -200px;
                left: -200px;
                animation: float 6s ease-in-out infinite;
            }

            .login-brand::after {
                content: "";
                position: absolute;
                width: 300px;
                height: 300px;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 50%;
                bottom: -100px;
                right: -100px;
                animation: float 8s ease-in-out infinite reverse;
            }

            @keyframes float {
                0%,
                100% {
                    transform: translateY(0) scale(1);
                }
                50% {
                    transform: translateY(-30px) scale(1.1);
                }
            }

            .brand-content {
                position: relative;
                z-index: 1;
                text-align: center;
                color: white;
            }

            .brand-illustration {
                width: 100%;
                max-width: 450px;
                margin-bottom: 40px;
                animation: fadeInUp 0.8s ease;
            }

            .brand-illustration svg {
                width: 100%;
                height: auto;
                filter: drop-shadow(0 20px 40px rgba(0, 0, 0, 0.2));
            }

            .brand-title {
                font-size: 3rem;
                font-weight: 800;
                margin-bottom: 16px;
                text-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
                animation: fadeInUp 0.8s ease 0.2s both;
            }

            .brand-subtitle {
                font-size: 1.25rem;
                opacity: 0.95;
                line-height: 1.6;
                max-width: 500px;
                animation: fadeInUp 0.8s ease 0.4s both;
            }

            .brand-features {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 30px;
                margin-top: 50px;
                animation: fadeInUp 0.8s ease 0.6s both;
            }

            .feature-item {
                text-align: center;
            }

            .feature-icon {
                width: 70px;
                height: 70px;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 2rem;
                margin: 0 auto 15px;
                transition: all 0.3s ease;
                backdrop-filter: blur(10px);
            }

            .feature-item:hover .feature-icon {
                transform: translateY(-10px) scale(1.1);
                background: rgba(255, 255, 255, 0.3);
            }

            .feature-text {
                font-size: 0.95rem;
                font-weight: 600;
            }

            /* Right Side - Form */
            .login-form-container {
                flex: 1;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 60px;
                background: var(--background);
                position: relative;
            }

            .back-button {
                position: absolute;
                top: 30px;
                left: 30px;
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 10px 20px;
                background: var(--card);
                border: 2px solid var(--border);
                border-radius: 50px;
                color: var(--foreground);
                text-decoration: none;
                font-weight: 600;
                font-size: 0.9rem;
                transition: all 0.3s ease;
                box-shadow: var(--shadow);
            }

            .back-button:hover {
                transform: translateX(-5px);
                border-color: var(--primary);
                box-shadow: var(--shadow-lg);
            }

            .login-form-wrapper {
                width: 100%;
                max-width: 480px;
                animation: fadeInRight 0.8s ease;
            }

            .form-header {
                margin-bottom: 40px;
            }

            .form-logo {
                width: 60px;
                height: 60px;
                background: var(--gradient-primary);
                border-radius: 16px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 2rem;
                color: white;
                margin-bottom: 24px;
                box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
            }

            .form-title {
                font-size: 2.5rem;
                font-weight: 800;
                color: var(--foreground);
                margin-bottom: 8px;
            }

            .form-subtitle {
                font-size: 1rem;
                color: var(--muted-foreground);
            }

            .login-form {
                display: flex;
                flex-direction: column;
                gap: 24px;
            }

            .form-group {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }

            .form-label {
                font-weight: 600;
                color: var(--foreground);
                font-size: 0.9rem;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .form-label i {
                color: var(--primary);
                font-size: 1rem;
            }

            .input-wrapper {
                position: relative;
            }

            .form-input {
                width: 100%;
                padding: 16px 20px 16px 50px;
                background: var(--card);
                border: 2px solid var(--border);
                border-radius: 12px;
                color: var(--foreground);
                font-size: 1rem;
                font-family: "Poppins", sans-serif;
                transition: all 0.3s ease;
                outline: none;
            }

            .form-input:focus {
                border-color: var(--primary);
                box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
                transform: translateY(-2px);
            }

            .input-icon {
                position: absolute;
                left: 18px;
                top: 50%;
                transform: translateY(-50%);
                color: var(--muted-foreground);
                font-size: 1.1rem;
                transition: all 0.3s ease;
            }

            .form-input:focus ~ .input-icon {
                color: var(--primary);
            }

            .password-toggle {
                position: absolute;
                right: 18px;
                top: 50%;
                transform: translateY(-50%);
                background: none;
                border: none;
                color: var(--muted-foreground);
                cursor: pointer;
                font-size: 1.1rem;
                padding: 8px;
                transition: all 0.3s ease;
            }

            .password-toggle:hover {
                color: var(--primary);
            }

            .form-options {
                display: flex;
                justify-content: space-between;
                align-items: center;
                font-size: 0.9rem;
            }

            .remember-me {
                display: flex;
                align-items: center;
                gap: 8px;
                cursor: pointer;
                color: var(--foreground);
            }

            .remember-me input[type="checkbox"] {
                width: 18px;
                height: 18px;
                cursor: pointer;
                accent-color: var(--primary);
            }

            .forgot-password {
                color: var(--primary);
                text-decoration: none;
                font-weight: 600;
                transition: all 0.3s ease;
            }

            .forgot-password:hover {
                color: var(--accent);
            }

            .btn-login {
                width: 100%;
                padding: 16px 24px;
                background: var(--gradient-primary);
                color: white;
                border: none;
                border-radius: 12px;
                font-size: 1.1rem;
                font-weight: 700;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
                font-family: "Poppins", sans-serif;
            }

            .btn-login:hover {
                transform: translateY(-3px);
                box-shadow: 0 12px 32px rgba(102, 126, 234, 0.4);
            }

            .btn-login:active {
                transform: translateY(-1px);
            }

            .btn-login:disabled {
                opacity: 0.6;
                cursor: not-allowed;
                transform: none;
            }

            .divider {
                display: flex;
                align-items: center;
                gap: 16px;
                color: var(--muted-foreground);
                font-size: 0.9rem;
                margin: 8px 0;
            }

            .divider::before,
            .divider::after {
                content: "";
                flex: 1;
                height: 1px;
                background: var(--border);
            }

            .signup-prompt {
                text-align: center;
                color: var(--muted-foreground);
                font-size: 0.95rem;
            }

            .signup-prompt a {
                color: var(--primary);
                font-weight: 700;
                text-decoration: none;
                transition: all 0.3s ease;
            }

            .signup-prompt a:hover {
                color: var(--accent);
            }

            .alert {
                padding: 14px 18px;
                border-radius: 12px;
                margin-bottom: 20px;
                display: flex;
                align-items: center;
                gap: 12px;
                font-size: 0.9rem;
                animation: slideDown 0.3s ease;
            }

            @keyframes slideDown {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .alert-error {
                background: rgba(255, 107, 107, 0.1);
                border: 2px solid var(--danger);
                color: var(--danger);
            }

            .alert-success {
                background: rgba(46, 204, 113, 0.1);
                border: 2px solid var(--success);
                color: var(--success);
            }

            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(30px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            @keyframes fadeInRight {
                from {
                    opacity: 0;
                    transform: translateX(30px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }

            /* Responsive Design */
            @media (max-width: 1024px) {
                .login-wrapper {
                    flex-direction: column;
                }

                .login-brand {
                    min-height: 40vh;
                    padding: 40px 30px;
                }

                .brand-title {
                    font-size: 2rem;
                }

                .brand-subtitle {
                    font-size: 1rem;
                }

                .brand-features {
                    grid-template-columns: repeat(3, 1fr);
                    gap: 20px;
                    margin-top: 30px;
                }

                .feature-icon {
                    width: 50px;
                    height: 50px;
                    font-size: 1.5rem;
                }

                .login-form-container {
                    padding: 40px 30px;
                    min-height: 60vh;
                }
            }

            @media (max-width: 768px) {
                .theme-toggle {
                    top: 15px;
                    right: 15px;
                    padding: 8px 14px;
                }

                .back-button {
                    top: 20px;
                    left: 20px;
                    padding: 8px 16px;
                    font-size: 0.85rem;
                }

                .login-brand {
                    padding: 30px 20px;
                }

                .brand-illustration {
                    max-width: 300px;
                    margin-bottom: 30px;
                }

                .brand-title {
                    font-size: 1.75rem;
                }

                .brand-features {
                    grid-template-columns: 1fr;
                    gap: 15px;
                }

                .login-form-container {
                    padding: 30px 20px;
                }

                .form-title {
                    font-size: 2rem;
                }

                .form-input {
                    padding: 14px 18px 14px 45px;
                }
            }

            @media (max-width: 480px) {
                .login-form-wrapper {
                    max-width: 100%;
                }

                .form-title {
                    font-size: 1.75rem;
                }

                .btn-login {
                    padding: 14px 20px;
                    font-size: 1rem;
                }
            }
        </style>
    </head>
    <body>
        <!-- Theme Toggle -->
        <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
            <i class="fas fa-sun theme-icon" id="themeIcon"></i>
        </button>

        <div class="login-wrapper">
            <!-- Left Side - Branding -->
            <div class="login-brand">
                <div class="brand-content">
                    <div class="brand-illustration">
                        <svg
                            viewBox="0 0 500 400"
                            xmlns="http://www.w3.org/2000/svg"
                        >
                            <!-- Illustration -->
                            <circle
                                cx="250"
                                cy="200"
                                r="180"
                                fill="rgba(255,255,255,0.1)"
                            />
                            <circle
                                cx="250"
                                cy="200"
                                r="140"
                                fill="rgba(255,255,255,0.15)"
                            />
                            <path
                                d="M250 80 L220 120 L280 120 Z"
                                fill="white"
                                opacity="0.9"
                            />
                            <rect
                                x="230"
                                y="120"
                                width="40"
                                height="80"
                                rx="5"
                                fill="white"
                                opacity="0.9"
                            />
                            <circle
                                cx="250"
                                cy="160"
                                r="30"
                                fill="rgba(102, 126, 234, 0.3)"
                            />
                            <path
                                d="M200 240 L170 280 Q165 290 175 295 L205 275 Z"
                                fill="white"
                                opacity="0.85"
                            />
                            <path
                                d="M300 240 L330 280 Q335 290 325 295 L295 275 Z"
                                fill="white"
                                opacity="0.85"
                            />
                            <circle
                                cx="180"
                                cy="300"
                                r="15"
                                fill="rgba(78, 205, 196, 0.4)"
                            />
                            <circle
                                cx="320"
                                cy="300"
                                r="15"
                                fill="rgba(255, 107, 107, 0.4)"
                            />
                            <rect
                                x="150"
                                y="150"
                                width="30"
                                height="5"
                                rx="2"
                                fill="white"
                                opacity="0.7"
                                transform="rotate(-45 165 152)"
                            />
                            <rect
                                x="320"
                                y="150"
                                width="30"
                                height="5"
                                rx="2"
                                fill="white"
                                opacity="0.7"
                                transform="rotate(45 335 152)"
                            />
                        </svg>
                    </div>

                    <h1 class="brand-title">Welcome to FixItNow</h1>
                    <p class="brand-subtitle">
                        Your trusted platform for home services and repairs.
                        Connect with verified professionals instantly.
                    </p>

                    <div class="brand-features">
                        <div class="feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="feature-text">
                                Verified Professionals
                            </div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="feature-text">24/7 Support</div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="feature-text">Quality Service</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Side - Login Form -->
            <div class="login-form-container">
                <a href="index.html" class="back-button">
                    <i class="fas fa-arrow-left"></i>
                    Back to Home
                </a>

                <div class="login-form-wrapper">
                    <div class="form-header">
                        <div class="form-logo">
                            <i class="fas fa-tools"></i>
                        </div>
                        <h2 class="form-title">Login to Account</h2>
                        <p class="form-subtitle">
                            Enter your credentials to access your account
                        </p>
                    </div>

                    <div id="alertContainer"></div>

                    <form class="login-form" id="loginForm">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-envelope"></i>
                                Email Address
                            </label>
                            <div class="input-wrapper">
                                <input
                                    type="email"
                                    name="email"
                                    class="form-input"
                                    placeholder="Enter your email"
                                    required
                                    autocomplete="email"
                                />
                                <i class="fas fa-envelope input-icon"></i>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-lock"></i>
                                Password
                            </label>
                            <div class="input-wrapper">
                                <input
                                    type="password"
                                    name="password"
                                    id="password"
                                    class="form-input"
                                    placeholder="Enter your password"
                                    required
                                    autocomplete="current-password"
                                />
                                <i class="fas fa-lock input-icon"></i>
                                <button
                                    type="button"
                                    class="password-toggle"
                                    id="togglePassword"
                                >
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>

                        <div class="form-options">
                            <label class="remember-me">
                                <input type="checkbox" name="remember" />
                                <span>Remember me</span>
                            </label>
                            <a href="#" class="forgot-password"
                                >Forgot Password?</a
                            >
                        </div>

                        <button type="submit" class="btn-login">
                            <span>Login Now</span>
                            <i class="fas fa-arrow-right"></i>
                        </button>

                        <div class="divider">or</div>

                        <div class="signup-prompt">
                            Don't have an account?
                            <a href="user_register.html">Sign up now</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <script>
            // Theme Toggle
            const themeToggle = document.getElementById("themeToggle");
            const themeIcon = document.getElementById("themeIcon");
            const html = document.documentElement;

            function setTheme(theme) {
                html.setAttribute("data-theme", theme);
                localStorage.setItem("theme", theme);

                if (theme === "dark") {
                    themeIcon.classList.remove("fa-sun");
                    themeIcon.classList.add("fa-moon");
                } else {
                    themeIcon.classList.remove("fa-moon");
                    themeIcon.classList.add("fa-sun");
                }
            }

            const currentTheme = localStorage.getItem("theme") || "light";
            setTheme(currentTheme);

            themeToggle.addEventListener("click", () => {
                const newTheme =
                    html.getAttribute("data-theme") === "dark"
                        ? "light"
                        : "dark";
                setTheme(newTheme);
            });

            // Password Toggle
            const togglePassword = document.getElementById("togglePassword");
            const passwordInput = document.getElementById("password");

            togglePassword.addEventListener("click", () => {
                const type =
                    passwordInput.type === "password" ? "text" : "password";
                passwordInput.type = type;

                const icon = togglePassword.querySelector("i");
                icon.classList.toggle("fa-eye");
                icon.classList.toggle("fa-eye-slash");
            });

            // Alert Functions
            function showAlert(message, type = "error") {
                const alertContainer =
                    document.getElementById("alertContainer");
                const alert = document.createElement("div");
                alert.className = `alert alert-${type}`;
                alert.innerHTML = `
                <i class="fas fa-${type === "error" ? "exclamation-circle" : "check-circle"}"></i>
                <span>${message}</span>
            `;
                alertContainer.innerHTML = "";
                alertContainer.appendChild(alert);

                setTimeout(() => {
                    alert.remove();
                }, 5000);
            }

            // Form Submission
            const loginForm = document.getElementById("loginForm");

            loginForm.addEventListener("submit", async (e) => {
                e.preventDefault();

                const formData = new FormData(loginForm);
                const email = formData.get("email");
                const password = formData.get("password");
                const rememberMe = formData.get("remember") === "on";

                if (!email || !password) {
                    showAlert("Please fill in all fields", "error");
                    return;
                }

                const submitButton = loginForm.querySelector(".btn-login");
                const originalContent = submitButton.innerHTML;
                submitButton.innerHTML =
                    '<i class="fas fa-spinner fa-spin"></i> Logging in...';
                submitButton.disabled = true;

                try {
                    const response = await fetch("/user/login", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            email,
                            password,
                            rememberMe,
                        }),
                    });

                    const result = await response.json();

                    if (response.ok && result.success) {
                        localStorage.setItem("token", result.token);
                        localStorage.setItem(
                            "user",
                            JSON.stringify(result.user),
                        );
                        localStorage.setItem("userId", result.user.id);
                        localStorage.setItem("userEmail", result.user.email);
                        localStorage.setItem(
                            "userName",
                            result.user.firstName + " " + result.user.lastName,
                        );

                        showAlert(
                            "Login successful! Redirecting...",
                            "success",
                        );

                        setTimeout(() => {
                            window.location.href = "dashboard.html";
                        }, 1500);
                    } else {
                        showAlert(
                            result.message ||
                                "Login failed. Please check your credentials.",
                            "error",
                        );
                        submitButton.innerHTML = originalContent;
                        submitButton.disabled = false;
                    }
                } catch (error) {
                    console.error("Login error:", error);
                    showAlert(
                        "Network error. Please try again later.",
                        "error",
                    );
                    submitButton.innerHTML = originalContent;
                    submitButton.disabled = false;
                }
            });

            // Input animations
            const inputs = document.querySelectorAll(".form-input");
            inputs.forEach((input) => {
                input.addEventListener("focus", () => {
                    input.parentElement.style.transform = "translateY(-2px)";
                });

                input.addEventListener("blur", () => {
                    input.parentElement.style.transform = "translateY(0)";
                });
            });
        </script>
    </body>
</html>
